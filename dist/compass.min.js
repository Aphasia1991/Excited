!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Compass=e():t.Compass=e()}(this,function(){return function(t){function e(i){if(s[i])return s[i].exports;var n=s[i]={exports:{},id:i,loaded:!1};return t[i].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var s={};return e.m=t,e.c=s,e.p="",e(0)}([function(t,e,s){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var n=s(5),o=i(n);e["default"]=o["default"]},function(t,e){"use strict";t.exports=function(){var t=[];return t.toString=function(){for(var t=[],e=0;e<this.length;e++){var s=this[e];s[2]?t.push("@media "+s[2]+"{"+s[1]+"}"):t.push(s[1])}return t.join("")},t.i=function(e,s){"string"==typeof e&&(e=[[null,e,""]]);for(var i={},n=0;n<this.length;n++){var o=this[n][0];"number"==typeof o&&(i[o]=!0)}for(n=0;n<e.length;n++){var r=e[n];"number"==typeof r[0]&&i[r[0]]||(s&&!r[2]?r[2]=s:s&&(r[2]="("+r[2]+") and ("+s+")"),t.push(r))}},t}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=/Eleme/.test(navigator.userAgent),i="//"+document.domain.replace(/^(h|h5)\./,"m.")+"/restapi",n=function(t){return fetch(t).then(function(t){var e=t.json();return t.status>=200&&t.status<300?e:e.then(Promise.reject.bind(Promise))})};e["default"]={props:{timeout:{type:Number,"default":5e3},show:{type:Boolean,"default":!0},tips:{type:Object,"default":function(){return{loading:"正在定位，请稍后...",failed:"定位失败，点此重新定位",fallback:"您附近的餐厅"}}},resolve:{type:Function,"default":function(){}},reject:{type:Function,"default":function(){}}},data:function(){return{geohash:"",locName:"",navHash:"",apiHash:"",apiLock:!1,isTrying:null}},computed:{locTips:function(){return this.isTrying?this.tips.loading:this.tips.failed}},watch:{geohash:function(t){t&&(this.clearTrying(),this.resolve(t),this.getLocName())}},methods:{clearTrying:function(){window[s?"clearInterval":"clearTimeout"](this.isTrying),this.isTrying=null},getLocName:function(){var t=this;this.show&&n(i+"/v2/pois/"+this.geohash).then(function(e){t.locName=e.name})["catch"](function(){t.locName=t.tips.fallback})},getApiHash:function(){var t=this;this.apiLock||(this.apiLock=!0,n(i+"/v1/cities?type=guess").then(function(e){t.apiHash=Geohash.encode(e.latitude,e.longitude)})["catch"](function(){t.apiLock=!1}))},getNavigatorHash:function(){var t=this;navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){t[s?"navHash":"geohash"]=Geohash.encode(e.coords.latitude,e.coords.longitude)})},getHybridHash:function(){var t=this;this.geohash||hybridAPI.getGlobalGeohash(function(e){if(e)return t.geohash=e})},selectBestLoc:function(){if(this.clearTrying(),!this.geohash)return this.navHash?this.geohash=this.navHash:this.apiHash?this.geohash=this.apiHash:void this.reject()},useAppMode:function(){var t=this;this.getHybridHash(),this.isTrying=setInterval(this.getHybridHash,500),setTimeout(function(){t.geohash||(t.getNavigatorHash(),t.getApiHash())},this.timeout/2),setTimeout(this.selectBestLoc,this.timeout)},useExternalMode:function(){this.isTrying=setTimeout(this.selectBestLoc,this.timeout),this.getNavigatorHash(),this.getApiHash()},getUserLoc:function(){this.geohash||(s?this.useAppMode():this.useExternalMode())}},events:{initCompass:function(t){return t?this.geohash=t:void this.getUserLoc()}}}},function(t,e,s){e=t.exports=s(1)(),e.push([t.id,".compass-wrap{position:relative;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;overflow:hidden;height:.933333rem}.compass-wrap svg{-webkit-box-flex:0;-webkit-flex-grow:0;flex-grow:0;-webkit-flex-shrink:0;flex-shrink:0;display:block;width:.48rem;height:.48rem}.compass-location{margin-right:.106667rem}.compass-refresh{position:absolute;top:50%;right:2rem;-webkit-transform:translateY(-50%) rotate(0);transform:translateY(-50%) rotate(0)}.compass-name,.compass-tips{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.compass-loading{-webkit-transform-origin:50% 50%;transform-origin:50% 50%;-webkit-animation:compass-rotation 1s linear infinite;animation:compass-rotation 1s linear infinite}@-webkit-keyframes compass-rotation{to{-webkit-transform:translateY(-50%) rotate(1turn);transform:translateY(-50%) rotate(1turn)}}@keyframes compass-rotation{to{-webkit-transform:translateY(-50%) rotate(1turn);transform:translateY(-50%) rotate(1turn)}}",""])},function(t,e){t.exports=' <div class=compass-wrap v-show=show @click=getUserLoc> <svg class=compass-location v-if=geohash viewBox="0 0 64 64" xmlns=http://www.w3.org/2000/svg><path d="M32 7.405c-10.856 0-19.657 8.8-19.657 19.657 0 10.858 15.405 27.472 15.405 27.472 2.348 2.743 6.193 2.758 8.518-.013 0 0 15.392-16.6 15.392-27.457 0-10.858-8.8-19.658-19.658-19.658zm0 28.123a9.092 9.092 0 0 1-9.094-9.094c0-5.02 4.07-9.092 9.094-9.092a9.093 9.093 0 1 1 0 18.186z" fill-rule=evenodd /></svg> <svg class=compass-refresh :class="[ isTrying ? \'compass-loading\': \'\' ]" v-else viewBox="0 0 64 64" xmlns=http://www.w3.org/2000/svg><path d="M52.255 32.99c.016-.335.025-.67.025-1.008C52.28 20.78 43.2 11.7 32 11.7a20.172 20.172 0 0 0-10.638 3.015 2.34 2.34 0 1 0 2.45 3.98A15.527 15.527 0 0 1 32 16.373c8.62 0 15.607 6.99 15.607 15.61 0 .337-.012.673-.034 1.008h-4.537l6.982 10 6.982-10h-4.745zM41.532 44.885c-.5 0-.964.155-1.344.423A15.527 15.527 0 0 1 32 47.63c-8.62 0-15.607-6.99-15.607-15.61 0-.34.012-.676.034-1.01h4.537l-6.982-9.998L7 31.01h4.745c-.016.335-.025.67-.025 1.008C11.72 43.22 20.8 52.3 32 52.3a20.17 20.17 0 0 0 10.64-3.015 2.34 2.34 0 0 0-1.107-4.404v.004z" fill-rule=evenodd /></svg> <span class=compass-name v-if=geohash>{{ locName }}</span> <span class=compass-tips v-else>{{ locTips }}</span> </div> '},function(t,e,s){var i,n;s(7),i=s(2),n=s(4),t.exports=i||{},t.exports.__esModule&&(t.exports=t.exports["default"]),n&&(("function"==typeof t.exports?t.exports.options||(t.exports.options={}):t.exports).template=n)},function(t,e,s){function i(t,e){for(var s=0;s<t.length;s++){var i=t[s],n=h[i.id];if(n){n.refs++;for(var o=0;o<n.parts.length;o++)n.parts[o](i.parts[o]);for(;o<i.parts.length;o++)n.parts.push(c(i.parts[o],e))}else{for(var r=[],o=0;o<i.parts.length;o++)r.push(c(i.parts[o],e));h[i.id]={id:i.id,refs:1,parts:r}}}}function n(t){for(var e=[],s={},i=0;i<t.length;i++){var n=t[i],o=n[0],r=n[1],a=n[2],c=n[3],l={css:r,media:a,sourceMap:c};s[o]?s[o].parts.push(l):e.push(s[o]={id:o,parts:[l]})}return e}function o(t,e){var s=d(),i=v[v.length-1];if("top"===t.insertAt)i?i.nextSibling?s.insertBefore(e,i.nextSibling):s.appendChild(e):s.insertBefore(e,s.firstChild),v.push(e);else{if("bottom"!==t.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");s.appendChild(e)}}function r(t){t.parentNode.removeChild(t);var e=v.indexOf(t);e>=0&&v.splice(e,1)}function a(t){var e=document.createElement("style");return e.type="text/css",o(t,e),e}function c(t,e){var s,i,n;if(e.singleton){var o=m++;s=g||(g=a(e)),i=l.bind(null,s,o,!1),n=l.bind(null,s,o,!0)}else s=a(e),i=u.bind(null,s),n=function(){r(s)};return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else n()}}function l(t,e,s,i){var n=s?"":i.css;if(t.styleSheet)t.styleSheet.cssText=b(e,n);else{var o=document.createTextNode(n),r=t.childNodes;r[e]&&t.removeChild(r[e]),r.length?t.insertBefore(o,r[e]):t.appendChild(o)}}function u(t,e){var s=e.css,i=e.media,n=e.sourceMap;if(i&&t.setAttribute("media",i),n&&(s+="\n/*# sourceURL="+n.sources[0]+" */",s+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */"),t.styleSheet)t.styleSheet.cssText=s;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(s))}}var h={},p=function(t){var e;return function(){return"undefined"==typeof e&&(e=t.apply(this,arguments)),e}},f=p(function(){return/msie [6-9]\b/.test(window.navigator.userAgent.toLowerCase())}),d=p(function(){return document.head||document.getElementsByTagName("head")[0]}),g=null,m=0,v=[];t.exports=function(t,e){e=e||{},"undefined"==typeof e.singleton&&(e.singleton=f()),"undefined"==typeof e.insertAt&&(e.insertAt="bottom");var s=n(t);return i(s,e),function(t){for(var o=[],r=0;r<s.length;r++){var a=s[r],c=h[a.id];c.refs--,o.push(c)}if(t){var l=n(t);i(l,e)}for(var r=0;r<o.length;r++){var c=o[r];if(0===c.refs){for(var u=0;u<c.parts.length;u++)c.parts[u]();delete h[c.id]}}}};var b=function(){var t=[];return function(e,s){return t[e]=s,t.filter(Boolean).join("\n")}}()},function(t,e,s){var i=s(3);"string"==typeof i&&(i=[[t.id,i,""]]);s(6)(i,{});i.locals&&(t.exports=i.locals)}])});