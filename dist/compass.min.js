!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Compass=e():t.Compass=e()}(this,function(){return function(t){function e(i){if(s[i])return s[i].exports;var o=s[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var s={};return e.m=t,e.c=s,e.p="",e(0)}([function(t,e,s){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var o=s(5),n=i(o);e["default"]=n["default"]},function(t,e){"use strict";t.exports=function(){var t=[];return t.toString=function(){for(var t=[],e=0;e<this.length;e++){var s=this[e];s[2]?t.push("@media "+s[2]+"{"+s[1]+"}"):t.push(s[1])}return t.join("")},t.i=function(e,s){"string"==typeof e&&(e=[[null,e,""]]);for(var i={},o=0;o<this.length;o++){var n=this[o][0];"number"==typeof n&&(i[n]=!0)}for(o=0;o<e.length;o++){var r=e[o];"number"==typeof r[0]&&i[r[0]]||(s&&!r[2]?r[2]=s:s&&(r[2]="("+r[2]+") and ("+s+")"),t.push(r))}},t}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){return fetch(t).then(function(t){var e=t.json();return t.status>=200&&t.status<300?e:e.then(Promise.reject.bind(Promise))})};e["default"]={props:{timeout:{type:Number,"default":5e3},apihost:{type:String,"default":"//m.ele.me/restapi"},show:{type:Boolean,"default":!0},tips:{type:Object,"default":function(){return{loading:"正在定位，请稍后...",failed:"定位失败，点此重新定位",fallback:"您附近的餐厅"}}},resolve:{type:Function,"default":function(){}},reject:{type:Function,"default":function(){}}},data:function(){return{geohash:"",locName:"",navHash:"",apiHash:"",apiLock:!1,isTrying:null}},computed:{locTips:function(){return this.isTrying?this.tips.loading:this.tips.failed}},watch:{geohash:function(t){t&&(clearTimeout(this.isTrying),this.resolve(t),this.getLocName())}},methods:{getLocName:function(){var t=this;this.show&&s(this.apihost+"/v2/pois/"+this.geohash).then(function(e){t.locName=e.name})["catch"](function(){t.locName=t.tips.fallback})},getApiHash:function(){var t=this;this.apiLock||(this.apiLock=!0,s(this.apihost+"/v1/cities?type=guess").then(function(e){t.apiHash=Geohash.encode(e.latitude,e.longitude)})["catch"](function(){t.apiLock=!1}))},getNavigatorHash:function(){var t=this;navigator.geolocation&&!this.navHash&&navigator.geolocation.getCurrentPosition(function(e){t.navHash=Geohash.encode(e.coords.latitude,e.coords.longitude)})},getHybridHash:function(){var t=this;hybridAPI.getGlobalGeohash(function(e){t.geohash=e})},selectBestLoc:function(){if(clearTimeout(this.isTrying),this.isTrying=null,!this.geohash)return this.navHash?this.geohash=this.navHash:this.apiHash?this.geohash=this.apiHash:void this.reject()},loopTryHybrid:function(){this.geohash||this.isTrying||(this.isTrying=setInterval(this.getHybridHash,500),setTimeout(this.selectBestLoc,this.timeout))},useAppMode:function(){var t=this,e=function(){t.geohash||(t.getNavigatorHash(),t.getApiHash())};this.getHybridHash(),this.loopTryHybrid(),setTimeout(e,this.timeout/2)},useExternalMode:function(){var t=this;this.isTrying=setTimeout(this.selectBestLoc,this.timeout),this.getNavigatorHash(),this.getApiHash(),this.$watch("navHash",function(e){t.geohash=e})},getUserLoc:function(){if(!this.geohash)return/Eleme/i.test(navigator.userAgent)?this.useAppMode():void this.useExternalMode()}},events:{initCompass:function(t){return t?this.geohash=t:void this.getUserLoc()}}}},function(t,e,s){e=t.exports=s(1)(),e.push([t.id,".compass-wrap{position:relative;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;height:.933333rem}.compass-wrap svg{-webkit-box-flex:0;-webkit-flex-grow:0;flex-grow:0;-webkit-flex-shrink:0;flex-shrink:0;display:block;width:.48rem;height:.48rem}.compass-location{margin-right:.106667rem}.compass-refresh{position:absolute;top:50%;right:2rem;-webkit-transform:translateY(-50%) rotate(0);transform:translateY(-50%) rotate(0)}.compass-name,.compass-tips{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.compass-loading{-webkit-transform-origin:50% 50%;transform-origin:50% 50%;-webkit-animation:compass-rotation 1s linear infinite;animation:compass-rotation 1s linear infinite}@-webkit-keyframes compass-rotation{to{-webkit-transform:translateY(-50%) rotate(1turn);transform:translateY(-50%) rotate(1turn)}}@keyframes compass-rotation{to{-webkit-transform:translateY(-50%) rotate(1turn);transform:translateY(-50%) rotate(1turn)}}",""])},function(t,e){t.exports=' <div class=compass-wrap v-show=show @click=getUserLoc> <svg class=compass-location v-if=geohash viewBox="0 0 64 64" xmlns=http://www.w3.org/2000/svg><path d="M32 7.405c-10.856 0-19.657 8.8-19.657 19.657 0 10.858 15.405 27.472 15.405 27.472 2.348 2.743 6.193 2.758 8.518-.013 0 0 15.392-16.6 15.392-27.457 0-10.858-8.8-19.658-19.658-19.658zm0 28.123a9.092 9.092 0 0 1-9.094-9.094c0-5.02 4.07-9.092 9.094-9.092a9.093 9.093 0 1 1 0 18.186z" fill-rule=evenodd /></svg> <svg class=compass-refresh :class="[ isTrying ? \'compass-loading\': \'\' ]" v-else viewBox="0 0 64 64" xmlns=http://www.w3.org/2000/svg><path d="M52.255 32.99c.016-.335.025-.67.025-1.008C52.28 20.78 43.2 11.7 32 11.7a20.172 20.172 0 0 0-10.638 3.015 2.34 2.34 0 1 0 2.45 3.98A15.527 15.527 0 0 1 32 16.373c8.62 0 15.607 6.99 15.607 15.61 0 .337-.012.673-.034 1.008h-4.537l6.982 10 6.982-10h-4.745zM41.532 44.885c-.5 0-.964.155-1.344.423A15.527 15.527 0 0 1 32 47.63c-8.62 0-15.607-6.99-15.607-15.61 0-.34.012-.676.034-1.01h4.537l-6.982-9.998L7 31.01h4.745c-.016.335-.025.67-.025 1.008C11.72 43.22 20.8 52.3 32 52.3a20.17 20.17 0 0 0 10.64-3.015 2.34 2.34 0 0 0-1.107-4.404v.004z" fill-rule=evenodd /></svg> <span class=compass-name v-if=geohash>{{ locName }}</span> <span class=compass-tips v-else>{{ locTips }}</span> </div> '},function(t,e,s){var i,o;s(7),i=s(2),o=s(4),t.exports=i||{},t.exports.__esModule&&(t.exports=t.exports["default"]),o&&(("function"==typeof t.exports?t.exports.options||(t.exports.options={}):t.exports).template=o)},function(t,e,s){function i(t,e){for(var s=0;s<t.length;s++){var i=t[s],o=l[i.id];if(o){o.refs++;for(var n=0;n<o.parts.length;n++)o.parts[n](i.parts[n]);for(;n<i.parts.length;n++)o.parts.push(c(i.parts[n],e))}else{for(var r=[],n=0;n<i.parts.length;n++)r.push(c(i.parts[n],e));l[i.id]={id:i.id,refs:1,parts:r}}}}function o(t){for(var e=[],s={},i=0;i<t.length;i++){var o=t[i],n=o[0],r=o[1],a=o[2],c=o[3],h={css:r,media:a,sourceMap:c};s[n]?s[n].parts.push(h):e.push(s[n]={id:n,parts:[h]})}return e}function n(t,e){var s=d(),i=v[v.length-1];if("top"===t.insertAt)i?i.nextSibling?s.insertBefore(e,i.nextSibling):s.appendChild(e):s.insertBefore(e,s.firstChild),v.push(e);else{if("bottom"!==t.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");s.appendChild(e)}}function r(t){t.parentNode.removeChild(t);var e=v.indexOf(t);e>=0&&v.splice(e,1)}function a(t){var e=document.createElement("style");return e.type="text/css",n(t,e),e}function c(t,e){var s,i,o;if(e.singleton){var n=m++;s=g||(g=a(e)),i=h.bind(null,s,n,!1),o=h.bind(null,s,n,!0)}else s=a(e),i=u.bind(null,s),o=function(){r(s)};return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else o()}}function h(t,e,s,i){var o=s?"":i.css;if(t.styleSheet)t.styleSheet.cssText=y(e,o);else{var n=document.createTextNode(o),r=t.childNodes;r[e]&&t.removeChild(r[e]),r.length?t.insertBefore(n,r[e]):t.appendChild(n)}}function u(t,e){var s=e.css,i=e.media,o=e.sourceMap;if(i&&t.setAttribute("media",i),o&&(s+="\n/*# sourceURL="+o.sources[0]+" */",s+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),t.styleSheet)t.styleSheet.cssText=s;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(s))}}var l={},p=function(t){var e;return function(){return"undefined"==typeof e&&(e=t.apply(this,arguments)),e}},f=p(function(){return/msie [6-9]\b/.test(window.navigator.userAgent.toLowerCase())}),d=p(function(){return document.head||document.getElementsByTagName("head")[0]}),g=null,m=0,v=[];t.exports=function(t,e){e=e||{},"undefined"==typeof e.singleton&&(e.singleton=f()),"undefined"==typeof e.insertAt&&(e.insertAt="bottom");var s=o(t);return i(s,e),function(t){for(var n=[],r=0;r<s.length;r++){var a=s[r],c=l[a.id];c.refs--,n.push(c)}if(t){var h=o(t);i(h,e)}for(var r=0;r<n.length;r++){var c=n[r];if(0===c.refs){for(var u=0;u<c.parts.length;u++)c.parts[u]();delete l[c.id]}}}};var y=function(){var t=[];return function(e,s){return t[e]=s,t.filter(Boolean).join("\n")}}()},function(t,e,s){var i=s(3);"string"==typeof i&&(i=[[t.id,i,""]]);s(6)(i,{});i.locals&&(t.exports=i.locals)}])});